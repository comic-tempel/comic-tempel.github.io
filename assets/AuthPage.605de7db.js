import{d as P,A as B,k as v,a,w as t,u as e,N,o as c,a9 as I,F as k,K as f,L as r,at as S,aD as b,aE as A,as as C,t as D,H as K,c as x,a1 as O,E as U,l as F,z as T,y as q,x as W,ae as j,a3 as z,a4 as J,Q as X,R as Y,U as Z,v as ee,aF as ae,aG as te,al as se,ak as G,s as ne,P as L,h as oe,i as ie,ap as le,aq as re}from"./index.79d194cd.js";import{u as H,t as M,o as $,e as Q,p as V,a as R}from"./validation.e50bc88d.js";import{a as de}from"./ui.82bacb6e.js";import{_ as ue}from"./plugin-vue_export-helper.21dcd24c.js";import{c as me,u as ce}from"./useMachine.47045379.js";var fe="/assets/header.d375a6b9.jpg";const pe=P({__name:"TheLoginForm",props:{email:{default:void 0},password:{default:void 0},isBusy:{type:Boolean,default:!1}},emits:["submit"],setup(n,{expose:p,emit:g}){const y=n,{handleSubmit:_,errors:d,meta:h,resetForm:w}=H({validationSchema:M($({email:Q,password:V}))}),{value:l}=R("email"),{value:u}=R("password"),i=_(s=>g("submit",s));return B(()=>l.value=y.email),B(()=>u.value=y.password),p({reset:w}),(s,o)=>(c(),v(N,null,[a(e(K),{class:"m-0",lines:"full"},{default:t(()=>[a(e(I),{class:k({"ion-invalid":e(d).email})},{default:t(()=>[a(e(f),{position:"floating"},{default:t(()=>[r("E-Mail Adresse")]),_:1}),a(e(S),{modelValue:e(l),"onUpdate:modelValue":o[0]||(o[0]=m=>b(l)?l.value=m:null),name:"email",type:"email",autocomplete:"email",inputmode:"email",required:"true",enterkeyhint:"next",autofocus:!0,disabled:n.isBusy,onKeyup:A(e(i),["enter"])},null,8,["modelValue","disabled","onKeyup"]),a(e(C),{slot:"error"},{default:t(()=>[r(D(e(d).email),1)]),_:1})]),_:1},8,["class"]),a(e(I),{class:k({"ion-invalid":e(d).password})},{default:t(()=>[a(e(f),{position:"floating"},{default:t(()=>[r("Passwort")]),_:1}),a(e(S),{modelValue:e(u),"onUpdate:modelValue":o[1]||(o[1]=m=>b(u)?u.value=m:null),name:"password",type:"password",required:"true",enterkeyhint:"send",disabled:n.isBusy,onKeyup:A(e(i),["enter"])},null,8,["modelValue","disabled","onKeyup"]),a(e(C),{slot:"error"},{default:t(()=>[r(D(e(d).password),1)]),_:1})]),_:1},8,["class"])]),_:1}),a(e(U),{class:"mt-5",expand:"full",disabled:!e(h).valid||n.isBusy,onClick:e(i)},{default:t(()=>[n.isBusy?(c(),x(e(O),{key:0,slot:"icon-only"})):(c(),v(N,{key:1},[r("anmelden")],64))]),_:1},8,["disabled","onClick"])],64))}}),ge={key:0,class:"text-center"},ye=F("div",{class:"text-5xl py-8 block"},"\u{1F389}",-1),_e=F("div",{class:"block"},"Du hast Dich erfolgreich angemeldet! Bitte \xF6ffne Dein Postfach und klick auf den Best\xE4tigungslink in unserer Nachricht.",-1),he=[ye,_e],we=P({__name:"TheRegistrationForm",props:{email:{default:void 0},isBusy:{type:Boolean,default:!1},isDone:{type:Boolean,default:!1}},emits:["submit"],setup(n,{expose:p,emit:g}){const y=n,{handleSubmit:_,errors:d,meta:h,resetForm:w}=H({validationSchema:M($({email:Q,password:V,confirmation:V.nonempty("Bitte wiederhole das Passwort")}).refine(o=>o.password==o.confirmation,{message:"Die Passw\xF6rter stimmen nicht \xFCberein",path:["confirmation"]}))}),{value:l}=R("email"),{value:u}=R("password"),{value:i}=R("confirmation"),s=_(o=>g("submit",o));return B(()=>l.value=y.email),p({reset:w}),(o,m)=>n.isDone?(c(),v("div",ge,he)):(c(),v(N,{key:1},[a(e(K),{class:"m-0",lines:"full"},{default:t(()=>[a(e(I),{class:k({"ion-invalid":e(d).email})},{default:t(()=>[a(e(f),{position:"floating"},{default:t(()=>[r("E-Mail Adresse")]),_:1}),a(e(S),{modelValue:e(l),"onUpdate:modelValue":m[0]||(m[0]=E=>b(l)?l.value=E:null),name:"email",type:"email",autocomplete:"email",inputmode:"email",required:"true",enterkeyhint:"next",autofocus:!0,disabled:n.isBusy,onKeyup:A(e(s),["enter"])},null,8,["modelValue","disabled","onKeyup"]),a(e(C),{slot:"error"},{default:t(()=>[r(D(e(d).email),1)]),_:1})]),_:1},8,["class"]),a(e(I),{class:k({"ion-invalid":e(d).password})},{default:t(()=>[a(e(f),{position:"floating"},{default:t(()=>[r("sicheres Passwort")]),_:1}),a(e(S),{modelValue:e(u),"onUpdate:modelValue":m[1]||(m[1]=E=>b(u)?u.value=E:null),name:"password",type:"password",required:"true",enterkeyhint:"send",disabled:n.isBusy,onKeyup:A(e(s),["enter"])},null,8,["modelValue","disabled","onKeyup"]),a(e(C),{slot:"error"},{default:t(()=>[r(D(e(d).password),1)]),_:1})]),_:1},8,["class"]),a(e(I),{class:k({"ion-invalid":e(d).confirmation})},{default:t(()=>[a(e(f),{position:"floating"},{default:t(()=>[r("Passwort wiederholen")]),_:1}),a(e(S),{modelValue:e(i),"onUpdate:modelValue":m[2]||(m[2]=E=>b(i)?i.value=E:null),name:"confirmation",type:"password",required:"true",enterkeyhint:"send",disabled:n.isBusy,onKeyup:A(e(s),["enter"])},null,8,["modelValue","disabled","onKeyup"]),a(e(C),{slot:"error"},{default:t(()=>[r(D(e(d).confirmation),1)]),_:1})]),_:1},8,["class"])]),_:1}),a(e(U),{class:"mt-5",expand:"full",disabled:!e(h).valid||n.isBusy,onClick:e(s)},{default:t(()=>[n.isBusy?(c(),x(e(O),{key:0,slot:"icon-only"})):(c(),v(N,{key:1},[r("ich bin dabei!")],64))]),_:1},8,["disabled","onClick"])],64))}});const Ee=n=>(le("data-v-06aa5742"),n=n(),re(),n),ve=Ee(()=>F("img",{class:"w-full",src:fe,alt:"Manga Wiki Kopzeile"},null,-1)),Ie=P({__name:"AuthPage",setup(n){const p=T(null),g=T(null),{login:y,register:_,currentSession:d}=q(),{replace:h}=W(),w=me({id:"Auth",initial:"Login",schema:{events:{}},on:{SESSION_CHANGED:{cond:"isAuthenticated",target:"Login.Authenticated"}},states:{Login:{initial:"AwaitingCredentials",on:{MODE_CHANGED:"Registration"},states:{AwaitingCredentials:{on:{LOGIN_REQUESTED:{target:"Processing"}}},Processing:{invoke:{src:"login",onDone:"Authenticated",onError:{actions:"showError",target:"AwaitingCredentials"}}},Authenticated:{type:"final",entry:"enterWiki"}}},Registration:{initial:"AwaitingCredentials",on:{MODE_CHANGED:"Login"},states:{AwaitingCredentials:{on:{REGISTRATION_REQUESTED:{target:"Processing"}}},Processing:{invoke:{src:"register",onDone:"Registered",onError:{actions:"showError",target:"AwaitingCredentials"}}},Registered:{type:"final"}}}}},{actions:{showError:(i,s)=>{var o;return de({message:(o=s.data)!=null?o:"Das hat leider nicht geklappt...",color:"danger"})},enterWiki:()=>h({name:"WikiPage"})},services:{login:(i,s)=>s.type==="LOGIN_REQUESTED"?y(s):Promise.reject(),register:(i,s)=>s.type==="REGISTRATION_REQUESTED"?_(s):Promise.reject()},guards:{isAuthenticated:(i,s)=>s.type==="SESSION_CHANGED"?s.isAuthenticated:!1}}),{state:l,send:u}=ce(w,{devTools:!1});return j(()=>d,i=>u("SESSION_CHANGED",{isAuthenticated:i!=null})),z(()=>u("SESSION_CHANGED",{isAuthenticated:d.value!=null})),J(()=>{var i,s;(i=p.value)==null||i.reset(),(s=g.value)==null||s.reset()}),(i,s)=>(c(),x(e(ie),null,{default:t(()=>[a(e(oe),null,{default:t(()=>[a(e(X),{class:"h-full"},{default:t(()=>[a(e(Y),{class:"h-full"},{default:t(()=>[a(e(Z),{class:"align-top md:flex md:align-middle"},{default:t(()=>[a(e(ee),{class:"rounded-none shadow-none m-auto w-full md:w-96 md:rounded-xl md:shadow-xl"},{default:t(()=>[ve,a(e(ae),null,{default:t(()=>[a(e(te),null,{default:t(()=>[r("Manga Wiki")]),_:1}),a(e(se),{class:"mt-4",value:"login",onIonChange:s[0]||(s[0]=o=>e(u)("MODE_CHANGED"))},{default:t(()=>[a(e(G),{value:"login"},{default:t(()=>[a(e(f),null,{default:t(()=>[r("Anmeldung")]),_:1})]),_:1}),a(e(G),{value:"registration"},{default:t(()=>[a(e(f),null,{default:t(()=>[r("Neu hier?")]),_:1})]),_:1})]),_:1})]),_:1}),a(e(ne),null,{default:t(()=>[e(l).matches("Login")?(c(),x(pe,{key:0,ref_key:"loginForm",ref:p,"is-busy":e(l).matches("Login.Processing"),onSubmit:s[1]||(s[1]=o=>e(u)("LOGIN_REQUESTED",o))},null,8,["is-busy"])):L("",!0),e(l).matches("Registration")?(c(),x(we,{key:1,ref_key:"registrationForm",ref:g,"is-busy":e(l).matches("Registration.Processing"),"is-done":e(l).matches("Registration.Registered"),onSubmit:s[2]||(s[2]=o=>e(u)("REGISTRATION_REQUESTED",o))},null,8,["is-busy","is-done"])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});var De=ue(Ie,[["__scopeId","data-v-06aa5742"]]);export{De as default};

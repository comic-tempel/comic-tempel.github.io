import{d as D,k as v,a,w as s,u as e,o as p,L as n,as as h,a9 as R,F as _,K as b,at as y,aD as P,t as C,H as S,c as x,a1 as k,N as B,E as T,z as A,y as U,x as O,j as Y,W as F,B as L,a6 as N,G as z,l as K,h as M,i as j}from"./index.283e1b67.js";import{u as q,t as H,o as Q,p as I,a as V}from"./validation.55a01406.js";import{c as Z,u as $}from"./useMachine.dd554155.js";const G=D({__name:"ThePasswordRecoveryForm",props:{state:null},emits:["submit"],setup(l,{expose:u,emit:w}){const{handleSubmit:f,errors:r,meta:E,resetForm:d}=q({validationSchema:H(Q({password:I,confirmation:I.nonempty("Bitte wiederhole das Passwort")}).refine(o=>o.password==o.confirmation,{message:"Die Passw\xF6rter stimmen nicht \xFCberein",path:["confirmation"]}))}),{value:c}=V("password"),{value:t}=V("confirmation"),i=f(o=>w("submit",{password:o.password}));return u({clear:d}),(o,m)=>(p(),v("div",null,[a(e(h),null,{default:s(()=>[n("Um sicherzustellen, dass Dein Konto gut gesch\xFCtzt ist, verwende bitte 8 oder mehr Zeichen mit einer Kombination aus Buchstaben, Zahlen & Symbolen.")]),_:1}),a(e(S),null,{default:s(()=>[a(e(R),{class:_({"ion-invalid":e(r).password})},{default:s(()=>[a(e(b),{position:"floating"},{default:s(()=>[n("sicheres Passwort")]),_:1}),a(e(y),{modelValue:e(c),"onUpdate:modelValue":m[0]||(m[0]=g=>P(c)?c.value=g:null),name:"password",type:"password",required:"true",enterkeyhint:"send",disabled:l.state=="Recovering"},null,8,["modelValue","disabled"]),a(e(h),{slot:"error"},{default:s(()=>[n(C(e(r).password),1)]),_:1})]),_:1},8,["class"]),a(e(R),{class:_({"ion-invalid":e(r).confirmation})},{default:s(()=>[a(e(b),{position:"floating"},{default:s(()=>[n("Passwort wiederholen")]),_:1}),a(e(y),{modelValue:e(t),"onUpdate:modelValue":m[1]||(m[1]=g=>P(t)?t.value=g:null),name:"confirmation",type:"password",required:"true",enterkeyhint:"send",disabled:l.state=="Recovering"},null,8,["modelValue","disabled"]),a(e(h),{slot:"error"},{default:s(()=>[n(C(e(r).confirmation),1)]),_:1})]),_:1},8,["class"])]),_:1}),a(e(T),{class:"absolute bottom-3.5 left-3.5 right-3.5",expand:"full",disabled:!e(E).valid||l.state=="Recovering",onClick:e(i)},{default:s(()=>[l.state=="Recovering"?(p(),x(e(k),{key:0,slot:"icon-only"})):(p(),v(B,{key:1},[n("Passwort speichern")],64))]),_:1},8,["disabled","onClick"])]))}}),W={class:"p-4"},ae=D({__name:"PasswordRecoveryPage",setup(l){const u=A(null),{updatePasswort:w}=U(),{replace:f}=O(),r=Z({id:"PasswordRecovery",initial:"AwaitingPassword",states:{AwaitingPassword:{on:{RECOVERY_REQUESTED:{target:"Recovering",actions:"recoverPassword"}}},Recovering:{on:{RECOVERY_SUCCEEDED:{target:"AwaitingPassword",actions:["toastSuccess","clearForm","exit"]},RECOVERY_FAILED:{target:"AwaitingPassword",actions:"toastFailure"}}}}},{actions:{toastSuccess:async()=>{(await F.create({message:"Dein Passwort wurde gespeichert.",color:"success",duration:2e3})).present()},toastFailure:async()=>{(await F.create({message:"Dein Passwort konnte nicht gespeichert werden. Bitte versuche es sp\xE4ter erneut.",color:"danger",duration:2e3})).present()},clearForm:()=>{var t;return(t=u.value)==null?void 0:t.clear()},exit:()=>f("/"),recoverPassword:async(t,i)=>{try{await w(i.password),d("RECOVERY_SUCCEEDED")}catch{d("RECOVERY_FAILED")}}}}),{state:E,send:d}=$(r,{devTools:!1}),c=Y(()=>E.value.value);return(t,i)=>(p(),x(e(j),null,{default:s(()=>[a(e(z),null,{default:s(()=>[a(e(L),null,{default:s(()=>[a(e(N),null,{default:s(()=>[n("Mein Passwort")]),_:1})]),_:1})]),_:1}),a(e(M),null,{default:s(()=>[K("div",W,[a(G,{ref_key:"form",ref:u,state:e(c),onSubmit:i[0]||(i[0]=o=>e(d)("RECOVERY_REQUESTED",o))},null,8,["state"])])]),_:1})]),_:1}))}});export{ae as default};

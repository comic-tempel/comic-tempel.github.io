import{d as A,z as u,A as _,_ as C,$ as W,o as B,c as H,w as E,l as v,u as y,h as M}from"./index.19ba1687.js";var j="/assets/beep.08636030.mp3";function D(){return new Worker("/assets/barcode-worker.5819c62b.js",{type:"module"})}const I=["src"],T=A({__name:"BarcodeScanner",emits:["scanned"],setup(O,{emit:k}){const t=u(null),e=u(null),h=u(null),s=u(),i=u("");let f=0;_(async()=>{i.value.length>0&&(setTimeout(()=>i.value="",1e3),k("scanned",i.value))});const m=a=>{if(e.value!==null&&t.value!==null&&s.value!==null&&s.value!==void 0&&e.value.readyState===e.value.HAVE_ENOUGH_DATA){const n=t.value.getContext("2d",{willReadFrequently:!0}),l=Math.max(t.value.width/e.value.videoWidth,t.value.height/e.value.videoHeight),r=e.value.videoHeight,c=e.value.videoWidth,g=t.value.height/2-r/2*l,p=t.value.width/2-c/2*l;if(t.value.height=t.value.clientHeight,t.value.width=t.value.clientWidth,n.drawImage(e.value,p,g,c*l,r*l),a-f>200){f=a;const o=document.createElement("canvas"),w=o.getContext("2d");o.width=t.value.width/l,o.height=t.value.height/l,w.drawImage(e.value,p/l,g/l,c,r);const d=w.getImageData(0,0,o.width,o.height);s.value.postMessage({data:d.data,width:d.width,height:d.height})}}requestAnimationFrame(m)};_(async()=>{if(e.value===null)return;const a=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:{ideal:800},height:{ideal:800}}});e.value.srcObject=a,e.value.setAttribute("playsinline",""),e.value.play(),requestAnimationFrame(m)});const b=()=>{s.value=new D,s.value.onmessage=a=>{var n;i.value!=a.data.data&&(i.value=a.data.data,(n=h.value)==null||n.play())}},x=()=>{var a;(a=s.value)==null||a.terminate()};return C(b),W(()=>{var a;e.value!==null&&(e.value.pause(),(a=e.value.srcObject)==null||a.getVideoTracks().forEach(n=>n.stop()),e.value.srcObject=null,x())}),(a,n)=>(B(),H(y(M),{"scroll-x":!1,"scroll-y":!1},{default:E(()=>[v("canvas",{class:"w-full h-48",ref_key:"displayCanvas",ref:t},null,512),v("video",{class:"hidden",ref_key:"video",ref:e},null,512),v("audio",{ref_key:"beepAudio",ref:h,src:y(j)},null,8,I)]),_:1}))}});export{T as _};

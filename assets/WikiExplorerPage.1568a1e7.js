import{_ as E,a as M}from"./BarcodeScannerModal.4e2c725f.js";import{d as S,o as r,c as i,w as a,j as p,a as s,u as e,k as g,l as R,m as N,n as T,p as V,r as d,q as $,s as F,t as H,v as W,x as Y,g as j,y as q,z as A,A as G,B as J,C as K,D as O,E as Q,F as U,G as b,H as y,J as I,K as k,L as X,h as Z,i as ee,M as ae,N as se,O as x,P as te}from"./index.f01522e6.js";import{e as le}from"./mangas.4d0a7d1d.js";import{b as re}from"./index.2d43f867.js";import{_ as ne}from"./CenteredMessage.1d71ace6.js";import{d as oe}from"./dayjs.min.40569ce3.js";import{_ as ie}from"./plugin-vue_export-helper.21dcd24c.js";import"./WikiImg.5cde3b83.js";import"./BarcodeScanner.292ccd56.js";const ue={class:"h-36 sm:h-40 lg:h-52 xl:h-64 overflow-clip"},ce={class:"text-sm"},de=S({__name:"MangaListItemSkeleton",setup(C){return(z,v)=>(r(),i(e(N),{class:"manga-card"},{default:a(()=>[p("div",ue,[s(e(g),{class:"m-0",animated:""})]),s(e(R),null,{default:a(()=>[p("div",ce,[s(e(g),{animated:""})])]),_:1})]),_:1}))}});const _e=S({__name:"WikiExplorerPage",setup(C){const{client:v}=te(),{push:w}=T(),{hasPermission:B}=V(),L=d(),u=d(null),c=d(""),h=d(!0),m=d(0);$(async()=>{const n=v.from("mangas").select("*, user_vlb_library(shelf)");let l=!1;setTimeout(()=>{l||(u.value=null)},200),c.value!=""?n.textSearch("title_tsv",c.value,{type:"websearch",config:"german"}):n.lte("date_published",oe().format("YYYY-MM-DD")),B("contribution.change_visibility")||n.is("is_visible",!0);const{data:_,error:o}=await n.range(0,20).order("date_published",{ascending:!1});if(o)u.value=[],console.error(o.message);else if(_!=null){const t=[];_.forEach(f=>t.push(le(f))),u.value=t}l=!0});const P=n=>{const l=n.detail.scrollTop;l<0||Math.abs(l-m.value)<60||(h.value=l<m.value,m.value=l)},D=async n=>{await w({name:"MangaDetailsPage",params:{gtin13:n}}),ae.dismiss()};return(n,l)=>{const _=se("auto-animate");return r(),i(e(ee),null,{default:a(()=>[s(e(A),{translucent:!0,class:q(["ion-no-border",{"header-hidden":!h.value}])},{default:a(()=>[s(e(F),{class:"search-toolbar"},{default:a(()=>[s(e(H),{ref:"searchBar",value:c.value,debounce:500,placeholder:"Manga suchen...",onIonChange:l[0]||(l[0]=o=>{var t;return c.value=(t=o.detail.value)!=null?t:""})},null,8,["value"]),s(e(W),{class:"mr-2",slot:"end"},{default:a(()=>[s(e(Y),{id:"scan-button",fill:"solid",color:"primary"},{default:a(()=>[s(e(j),{slot:"icon-only",src:e(re)},null,8,["src"])]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]),s(e(Z),{fullscreen:!0,"scroll-events":!0,onIonScroll:l[1]||(l[1]=o=>P(o))},{default:a(()=>{var o;return[s(E,{ref_key:"barcodeScanner",ref:L,trigger:"scan-button",onScanned:D},null,512),((o=u.value)==null?void 0:o.length)!=0?(r(),i(e(G),{key:0},{default:a(()=>[c.value==""?(r(),i(e(J),{key:0},{default:a(()=>[s(e(K),{class:"text-xl mt-2"},{default:a(()=>[O("Manga-Neuerscheinungen")]),_:1})]),_:1})):Q("",!0),s(e(U),null,{default:a(()=>[u.value==null?(r(),i(e(b),{key:0},{default:a(()=>[(r(!0),y(k,null,I(20+1,t=>(r(),i(e(x),{key:t,"size-lg":"2","size-md":"3","size-sm":"4","size-xs":"4"},{default:a(()=>[s(de)]),_:2},1024))),128))]),_:1})):X((r(),i(e(b),{key:1},{default:a(()=>[(r(!0),y(k,null,I(u.value,t=>(r(),i(e(x),{key:t.gtin13,"size-lg":"2","size-md":"3","size-sm":"4","size-xs":"4"},{default:a(()=>{var f;return[s(M,{title:t.title,"cover-url":(f=t.cover("m"))!=null?f:"","is-visible":t.is_visible,shelf:t.shelf,"router-link":`/manga/${t.gtin13}`},null,8,["title","cover-url","is-visible","shelf","router-link"])]}),_:2},1024))),128))]),_:1})),[[_]])]),_:1})]),_:1})):(r(),i(ne,{key:1,emoji:"\u{1F914}",text:"Weder Serien noch Einzelausgaben gefunden"}))]}),_:1})]),_:1})}}});var ke=ie(_e,[["__scopeId","data-v-d95f45fa"]]);export{ke as default};

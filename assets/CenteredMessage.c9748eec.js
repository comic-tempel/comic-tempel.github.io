import{d as g,x as v,o as p,k as j,J as W,T as B,a as h,u as c,l as E,U as H,M as T,q as V,K as q,c as y,w as m,n as o,H as U,t as k,r as N,s as F,P as O,y as S,V as L,W as P,h as G,X as J,Y as K,p as R}from"./index.181d1343.js";import{_ as X}from"./plugin-vue_export-helper.21dcd24c.js";var Y="/assets/cover-missing.a888693e.png";const z=g({props:{src:null},setup(i){const s=v("unmounted");return(a,e)=>(p(),j(q,null,[W(h(c(E),{class:"w-full h-full object-cover object-top",src:i.src,onIonImgWillLoad:e[0]||(e[0]=u=>s.value="loading"),onIonImgDidLoad:e[1]||(e[1]=u=>s.value="loaded"),onIonError:e[2]||(e[2]=u=>s.value="missing")},null,8,["src"]),[[B,s.value=="unmounted"||s.value=="loaded"]]),s.value=="missing"?H(a.$slots,"default",{key:0}):T("",!0),W(h(c(V),{class:"m-0 h-full w-full",animated:""},null,512),[[B,s.value=="loading"]])],64))}}),Q={class:"h-36 sm:h-40 lg:h-52 xl:h-64 overflow-clip"},Z=o("div",{class:"opacity-30"},[o("img",{class:"w-full",src:Y})],-1),ee={class:"absolute left-3 top-3"},ae=O("kein Cover"),te={class:"line-clamp-1 text-sm"},he=g({props:{title:null,coverUrl:null},setup(i){return(s,a)=>(p(),y(c(F),{class:"manga-card",button:""},{default:m(()=>[o("div",Q,[h(z,{src:i.coverUrl},{default:m(()=>[Z,o("div",ee,[h(c(U),{class:"text-white"},{default:m(()=>[ae]),_:1})])]),_:1},8,["src"])]),h(c(N),null,{default:m(()=>[o("div",te,k(i.title),1)]),_:1})]),_:1}))}});var se="/assets/beep.08636030.mp3";function ne(){return new Worker("/assets/barcode-worker.5819c62b.js",{type:"module"})}const le=["src"],oe=g({emits:["scanned"],setup(i,{emit:s}){const a=v(null),e=v(null),u=v(null),l=v(),n=v("");let _=0;S(async()=>{n.value.length>0&&(setTimeout(()=>n.value="",1e3),s("scanned",n.value))});const I=t=>{if(e.value!==null&&a.value!==null&&l.value!==null&&l.value!==void 0&&e.value.readyState===e.value.HAVE_ENOUGH_DATA){const d=a.value.getContext("2d",{willReadFrequently:!0}),r=Math.max(a.value.width/e.value.videoWidth,a.value.height/e.value.videoHeight),w=e.value.videoHeight,x=e.value.videoWidth,C=a.value.height/2-w/2*r,$=a.value.width/2-x/2*r;if(a.value.height=a.value.clientHeight,a.value.width=a.value.clientWidth,d.drawImage(e.value,$,C,x*r,w*r),t-_>200){_=t;const f=document.createElement("canvas"),M=f.getContext("2d");f.width=a.value.width/r,f.height=a.value.height/r,M.drawImage(e.value,$/r,C/r,x,w);const b=M.getImageData(0,0,f.width,f.height);l.value.postMessage({data:b.data,width:b.width,height:b.height})}}requestAnimationFrame(I)};S(async()=>{if(e.value===null)return;const t=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:{ideal:800},height:{ideal:800}}});e.value.srcObject=t,e.value.setAttribute("playsinline",""),e.value.play(),requestAnimationFrame(I)});const A=()=>{l.value=new ne,l.value.onmessage=t=>{var d;n.value!=t.data.data&&(n.value=t.data.data,(d=u.value)==null||d.play())}},D=()=>{var t;(t=l.value)==null||t.terminate()};return L(A),P(()=>{var t;e.value!==null&&(e.value.pause(),(t=e.value.srcObject)==null||t.getVideoTracks().forEach(d=>d.stop()),e.value.srcObject=null,D())}),(t,d)=>(p(),y(c(G),{"scroll-x":!1,"scroll-y":!1},{default:m(()=>[o("canvas",{class:"w-full h-48",ref_key:"displayCanvas",ref:a},null,512),o("video",{class:"hidden",ref_key:"video",ref:e},null,512),o("audio",{ref_key:"beepAudio",ref:u,src:c(se)},null,8,le)]),_:1}))}});const ie=g({emits:["scanned"],setup(i,{emit:s}){const{client:a}=R(),e=async l=>{const{data:n,error:_}=await a.from("mangas").select().or(`gtin13.eq.${l},isbn10.eq.${l}`).single();return _||n==null?Promise.reject(new Error("Das ist kein Manga")):n},u=async l=>{try{const n=await e(l);s("scanned",n.gtin13)}catch(n){(await K.create({message:n.message,duration:2e3,color:"warning"})).present()}};return(l,n)=>(p(),y(c(J),{id:"barcode-modal","initial-breakpoint":1,breakpoints:[0,1]},{default:m(()=>[h(oe,{onScanned:u})]),_:1},8,["initial-breakpoint","breakpoints"]))}});var _e=X(ie,[["__scopeId","data-v-7457ae95"]]);const re={class:"h-full grid place-items-center"},ce={class:"text-center"},ue={class:"text-6xl"},de={class:"text-md text-medium-default mt-8 w-40"},fe=g({props:{emoji:null,text:null},setup(i){return(s,a)=>(p(),j("div",re,[o("div",ce,[o("div",ue,k(i.emoji),1),o("div",de,k(i.text),1)])]))}});export{_e as B,z as _,fe as a,he as b,Y as p};

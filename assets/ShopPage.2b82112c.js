import{d as g,o as v,H as I,a as o,w as t,L as h,u as n,x as C,D as _,V as w,m as B,S as x,K as V,j as b,M as T,p as y,r as S,P as k,a2 as D,a3 as E,a4 as $,c as F,s as M,a5 as N,v as P,ao as j,z as H,h as L,i as z,aC as A}from"./index.13905425.js";import{_ as K}from"./BarcodeScanner.d34e28b9.js";import{a as U}from"./ui.6b8b16d0.js";var W="/assets/logo-comic-tempel.a6b5d799.jpg";const q=b("img",{src:W},null,-1),G=g({__name:"ShopCardComicTempel",props:{isConnected:{type:Boolean}},emits:["connect","disconnect"],setup(a,{emit:c}){const i=l=>{/^B!\w+!\w$/.test(l)?(T.dismiss(),c("connect",l)):U({message:"Das ist keine Tempel-Card",color:"warning"})},u=()=>{c("disconnect")};return(l,p)=>(v(),I(V,null,[o(n(B),{class:"text-center"},{default:t(()=>[q,h(o(n(C),{id:"scan-tempel-card",fill:"clear"},{default:t(()=>[_("Tempel-Card scannen")]),_:1},512),[[w,!a.isConnected]]),h(o(n(C),{fill:"clear",onClick:u},{default:t(()=>[_("Verbindung trennen")]),_:1},512),[[w,a.isConnected]])]),_:1}),o(n(x),{class:"barcode-scanner",trigger:"scan-tempel-card","initial-breakpoint":1,breakpoints:[0,1]},{default:t(()=>[o(K,{onScanned:i})]),_:1},8,["initial-breakpoint","breakpoints"])],64))}}),J=()=>{const{client:a}=k(),{currentUser:c}=y(),i=S([]);return{loadConnections:async()=>{const{data:s,error:e}=await a.from("user_shops").select();if(e)throw new Error(e.message);i.value=s},findConnection:s=>i.value.find(({shop_name:e})=>e==s),connectShop:async(s,e)=>{var d,f;const{error:r}=await a.from("user_shops").upsert({user_id:(f=(d=c.value)==null?void 0:d.id)!=null?f:"",shop_name:s,shop_user_id:e.trim()});if(r)throw Error(r.message)},disconnectShop:async s=>{var r;const{error:e}=await a.from("user_shops").delete().match({user_id:(r=c.value)==null?void 0:r.id,shop_name:s});if(e)throw Error(e.message)}}},O={class:"p-8"},Y=g({__name:"ShopPage",setup(a){const{client:c}=k(),{connectShop:i,disconnectShop:u,findConnection:l,loadConnections:p}=J();let m=S(null);return D(()=>{m.value=c.channel("any").on("postgres_changes",{event:"*",schema:"public",table:"user_shops"},p).subscribe()}),E(()=>{var s;return(s=m.value)==null?void 0:s.unsubscribe()}),$(()=>p()),(s,e)=>{const r=A("Feature");return v(),F(n(z),null,{default:t(()=>[o(n(H),null,{default:t(()=>[o(n(M),null,{default:t(()=>[o(n(N),null,{default:t(()=>[_("Meine Shops")]),_:1}),o(n(P),{slot:"start"},{default:t(()=>[o(n(j),{"default-href":"/",text:""})]),_:1})]),_:1})]),_:1}),o(n(L),null,{default:t(()=>[b("div",O,[o(r,{"feature-key":"shopsComicTempel"},{default:t(()=>[o(G,{"is-connected":n(l)("comic-tempel")!==void 0,onConnect:e[0]||(e[0]=d=>n(i)("comic-tempel",d)),onDisconnect:e[1]||(e[1]=d=>n(u)("comic-tempel"))},null,8,["is-connected"])]),_:1})])]),_:1})]),_:1})}}});export{Y as default};

import{d as _,r as d,o as g,x as $,C as x,D as I,a as m,u as r,E as A,G as D,H as E,J as j,F as H,c as w,w as v,K as i,L as T,M as N,N as V,O as q,z as F,P as C,Q as O,R as U,h as L,S as G,T as P,A as R}from"./index.2d6df163.js";import{_ as z}from"./plugin-vue_export-helper.21dcd24c.js";var J="/assets/cover-missing.a888693e.png";const K=_({props:{src:null},setup(u){const n=d("unmounted");return(a,e)=>(g(),$(H,null,[x(m(r(A),{class:"w-full h-full object-cover object-top",src:u.src,onIonImgWillLoad:e[0]||(e[0]=c=>n.value="loading"),onIonImgDidLoad:e[1]||(e[1]=c=>n.value="loaded"),onIonError:e[2]||(e[2]=c=>n.value="missing")},null,8,["src"]),[[I,n.value=="unmounted"||n.value=="loaded"]]),n.value=="missing"?D(a.$slots,"default",{key:0}):E("",!0),x(m(r(j),{class:"m-0 h-full w-full",animated:""},null,512),[[I,n.value=="loading"]])],64))}}),Q={class:"h-36 sm:h-40 lg:h-52 xl:h-64 overflow-clip"},X=i("div",{class:"opacity-30"},[i("img",{class:"w-full",src:J})],-1),Y={class:"absolute left-3 top-3"},Z=F("kein Cover"),ee={class:"line-clamp-1 text-sm"},ie=_({props:{title:null,coverUrl:null},setup(u){return(n,a)=>(g(),w(r(q),{class:"manga-card",button:""},{default:v(()=>[i("div",Q,[m(K,{src:u.coverUrl},{default:v(()=>[X,i("div",Y,[m(r(T),{class:"text-white"},{default:v(()=>[Z]),_:1})])]),_:1},8,["src"])]),m(r(V),null,{default:v(()=>[i("div",ee,N(u.title),1)]),_:1})]),_:1}))}});var ae="/assets/beep.08636030.mp3";function te(){return new Worker("/assets/barcode-worker.5819c62b.js",{type:"module"})}const se=["src"],ne=_({emits:["scanned"],setup(u,{emit:n}){const a=d(null),e=d(null),c=d(null),l=d(),s=d("");let f=0;C(async()=>{s.value.length>0&&(setTimeout(()=>s.value="",1e3),n("scanned",s.value))});const k=t=>{if(e.value!==null&&a.value!==null&&l.value!==null&&l.value!==void 0&&e.value.readyState===e.value.HAVE_ENOUGH_DATA){const o=a.value.getContext("2d",{willReadFrequently:!0}),h=Math.max(a.value.width/e.value.videoWidth,a.value.height/e.value.videoHeight),b=e.value.videoHeight,y=e.value.videoWidth,B=a.value.height/2-b/2*h,W=a.value.width/2-y/2*h;if(a.value.height=a.value.clientHeight,a.value.width=a.value.clientWidth,o.drawImage(e.value,W,B,y*h,b*h),t-f>200){f=t;const p=o.getImageData(0,0,a.value.width,a.value.height);l.value.postMessage({data:p.data,width:p.width,height:p.height})}}requestAnimationFrame(k)};C(async()=>{if(e.value===null)return;const t=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}});e.value.srcObject=t,e.value.play(),requestAnimationFrame(k)});const M=()=>{l.value=new te,l.value.onmessage=t=>{var o;s.value!=t.data.data&&(s.value=t.data.data,(o=c.value)==null||o.play())}},S=()=>{var t;(t=l.value)==null||t.terminate()};return O(M),U(()=>{var t;e.value!==null&&(e.value.pause(),(t=e.value.srcObject)==null||t.getVideoTracks().forEach(o=>o.stop()),e.value.srcObject=null,S())}),(t,o)=>(g(),w(r(L),{"scroll-x":!1,"scroll-y":!1},{default:v(()=>[i("canvas",{class:"w-full h-48",ref_key:"canvas",ref:a},null,512),i("video",{class:"hidden",ref_key:"video",ref:e},null,512),i("audio",{ref_key:"beepAudio",ref:c,src:r(ae)},null,8,se)]),_:1}))}});const le=_({emits:["scanned"],setup(u,{emit:n}){const{client:a}=R(),e=async l=>{const{data:s,error:f}=await a.from("mangas").select().or(`gtin13.eq.${l},isbn10.eq.${l}`).single();return f||s==null?Promise.reject(new Error("Das ist kein Manga")):s},c=async l=>{try{const s=await e(l);n("scanned",s.gtin13)}catch(s){(await P.create({message:s.message,duration:2e3,color:"warning"})).present()}};return(l,s)=>(g(),w(r(G),{id:"barcode-modal","initial-breakpoint":1,breakpoints:[0,1]},{default:v(()=>[m(ne,{onScanned:c})]),_:1},8,["initial-breakpoint","breakpoints"]))}});var ce=z(le,[["__scopeId","data-v-7457ae95"]]);export{ce as B,ie as _,K as a,J as p};

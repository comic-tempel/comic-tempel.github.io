var g=Object.defineProperty,q=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var d=(s,l,e)=>l in s?g(s,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[l]=e,u=(s,l)=>{for(var e in l||(l={}))E.call(l,e)&&d(s,e,l[e]);if(_)for(var e of _(l))k.call(l,e)&&d(s,e,l[e]);return s},v=(s,l)=>q(s,A(l));import{y as x,an as S,z as p,A as b,av as U,q as C}from"./index.4480e0c3.js";import{e as F}from"./mangas.549edce8.js";const{client:w,proxyUrlFor:M}=C(),P=s=>{const l=p([]);return b(async()=>{const e=w.from("collections").select().limit(10);s.value&&e.textSearch("collection_name",s.value,{type:"phrase"});const{data:a,error:i}=await e;if(i)throw Error(i.message);l.value=a.map(n=>{var o;return v(u({},n),{cover:M((o=n.cover)!=null?o:"","s")})})}),{collections:U(l)}},j=s=>{const{hasPermission:l}=x(),e=S({name:null,publisherName:"",coverUrl:"",contributors:[],keywords:[]}),a=p([]),i=async n=>{var m,y;const o=w.from("mangas").select("*,user_vlb_library(*)");l("contribution.change_visibility")||o.is("is_visible",!0);const{data:t,error:f}=await o.eq("collection_id",n).order("date_published",{ascending:!1});if(f)throw Error(f.message);t!=null&&t.length>0&&(t.forEach(r=>{var h;let c;r.user_vlb_library!==null&&Array.isArray(r.user_vlb_library)&&r.user_vlb_library.length>0&&(c=(h=r.user_vlb_library[0].shelf)!=null?h:void 0),a.value.push(v(u({},F(r)),{shelf:c}))}),e.name=(m=t[0].collection_name)!=null?m:null,e.publisherName=t[0].publisher_name,e.coverUrl=(y=a.value.map(r=>r.cover("m")).find(r=>r!=null))!=null?y:"",e.keywords=[...new Set(a.value.flatMap(({keywords:r})=>r))],e.contributors=[...new Set(a.value.flatMap(({contributors:r})=>r==null?void 0:r.map(({name:c})=>c)))])};return b(()=>i(s.value)),{mangas:a,collection:e}};export{j as a,P as u};

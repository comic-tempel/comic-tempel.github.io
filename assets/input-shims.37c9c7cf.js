import{aA as b,aB as A,ay as P,aw as T,aC as C}from"./index.9d09462e.js";/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const L=new WeakMap,g=(e,t,o,r=0)=>{L.has(e)!==o&&(o?M(e,t,r):N(e,t))},I=e=>e===e.getRootNode().activeElement,M=(e,t,o)=>{const r=t.parentNode,n=t.cloneNode(!1);n.classList.add("cloned-input"),n.tabIndex=-1,r.appendChild(n),L.set(e,n);const d=e.ownerDocument.dir==="rtl"?9999:-9999;e.style.pointerEvents="none",t.style.transform=`translate3d(${d}px,${o}px,0) scale(0)`},N=(e,t)=>{const o=L.get(e);o&&(L.delete(e),o.remove()),e.style.pointerEvents="",t.style.transform=""},p=(e,t,o)=>{if(!o||!t)return()=>{};const r=c=>{I(t)&&g(e,t,c)},n=()=>g(e,t,!1),s=()=>r(!0),d=()=>r(!1);return A(o,"ionScrollStart",s),A(o,"ionScrollEnd",d),t.addEventListener("blur",n),()=>{b(o,"ionScrollStart",s),b(o,"ionScrollEnd",d),t.addEventListener("ionBlur",n)}},y="input, textarea, [no-blur], [contenteditable]",x=()=>{let e=!0,t=!1;const o=document,r=()=>{t=!0},n=()=>{e=!0},s=d=>{if(t){t=!1;return}const c=o.activeElement;if(!c||c.matches(y))return;const i=d.target;i!==c&&(i.matches(y)||i.closest(y)||(e=!1,setTimeout(()=>{e||c.blur()},50)))};return A(o,"ionScrollStart",r),o.addEventListener("focusin",n,!0),o.addEventListener("touchend",s,!1),()=>{b(o,"ionScrollStart",r,!0),o.removeEventListener("focusin",n,!0),o.removeEventListener("touchend",s,!1)}},R=.3,K=(e,t,o)=>{const r=e.closest("ion-item,[ion-item]")||e;return _(r.getBoundingClientRect(),t.getBoundingClientRect(),o,e.ownerDocument.defaultView.innerHeight)},_=(e,t,o,r)=>{const n=e.top,s=e.bottom,d=t.top,c=Math.min(t.bottom,r-o),i=d+15,f=c*.75-s,m=i-n,a=Math.round(f<0?-f:m>0?-m:0),u=Math.min(a,n-d),v=Math.abs(u)/R,w=Math.min(400,Math.max(150,v));return{scrollAmount:u,scrollDuration:w,scrollPadding:o,inputSafeY:-(n-i)+4}},O=(e,t,o,r,n)=>{let s;const d=i=>{s=T(i)},c=i=>{if(!s)return;const l=T(i);!k(6,s,l)&&!I(t)&&(i.stopPropagation(),F(e,t,o,r,n))};return e.addEventListener("touchstart",d,!0),e.addEventListener("touchend",c,!0),()=>{e.removeEventListener("touchstart",d,!0),e.removeEventListener("touchend",c,!0)}},F=async(e,t,o,r,n)=>{if(!o&&!r)return;const s=K(e,o||r,n);if(o&&Math.abs(s.scrollAmount)<4){t.focus();return}if(g(e,t,!0,s.inputSafeY),t.focus(),C(()=>e.click()),typeof window!="undefined"){let d;const c=async()=>{d!==void 0&&clearTimeout(d),window.removeEventListener("ionKeyboardDidShow",i),window.removeEventListener("ionKeyboardDidShow",c),o&&await o.scrollByPoint(0,s.scrollAmount,s.scrollDuration),g(e,t,!1,s.inputSafeY),t.focus()},i=()=>{window.removeEventListener("ionKeyboardDidShow",i),window.addEventListener("ionKeyboardDidShow",c)};if(o){const l=await o.getScrollElement(),f=l.scrollHeight-l.clientHeight;if(s.scrollAmount>f-l.scrollTop){t.type==="password"?(s.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",i)):window.addEventListener("ionKeyboardDidShow",c),d=setTimeout(c,1e3);return}}c()}},k=(e,t,o)=>{if(t&&o){const r=t.x-o.x,n=t.y-o.y;return r*r+n*n>e*e}return!1},B="$ionPaddingTimer",H=e=>{const t=document,o=n=>{D(n.target,e)},r=n=>{D(n.target,0)};return t.addEventListener("focusin",o),t.addEventListener("focusout",r),()=>{t.removeEventListener("focusin",o),t.removeEventListener("focusout",r)}},D=(e,t)=>{var o,r;if(e.tagName!=="INPUT"||e.parentElement&&e.parentElement.tagName==="ION-INPUT"||((r=(o=e.parentElement)===null||o===void 0?void 0:o.parentElement)===null||r===void 0?void 0:r.tagName)==="ION-SEARCHBAR")return;const n=e.closest("ion-content");if(n===null)return;const s=n[B];s&&clearTimeout(s),t>0?n.style.setProperty("--keyboard-offset",`${t}px`):n[B]=setTimeout(()=>{n.style.setProperty("--keyboard-offset","0px")},120)},U=!0,Y=!0,q=e=>{const t=document,o=e.getNumber("keyboardHeight",290),r=e.getBoolean("scrollAssist",!0),n=e.getBoolean("hideCaretOnScroll",!0),s=e.getBoolean("inputBlurring",!0),d=e.getBoolean("scrollPadding",!0),c=Array.from(t.querySelectorAll("ion-input, ion-textarea")),i=new WeakMap,l=new WeakMap,f=async a=>{await new Promise(S=>P(a,S));const u=a.shadowRoot||a,h=u.querySelector("input")||u.querySelector("textarea"),v=a.closest("ion-content"),w=v?null:a.closest("ion-footer");if(!!h){if(!!v&&n&&!i.has(a)){const S=p(a,h,v);i.set(a,S)}if((!!v||!!w)&&r&&!l.has(a)){const S=O(a,h,v,w,o);l.set(a,S)}}},m=a=>{if(n){const u=i.get(a);u&&u(),i.delete(a)}if(r){const u=l.get(a);u&&u(),l.delete(a)}};s&&U&&x(),d&&Y&&H(o);for(const a of c)f(a);t.addEventListener("ionInputDidLoad",a=>{f(a.detail)}),t.addEventListener("ionInputDidUnload",a=>{m(a.detail)})};export{q as startInputShims};

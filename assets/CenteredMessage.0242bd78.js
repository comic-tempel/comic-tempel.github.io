import{_ as V,a as j}from"./WikiImg.6145a022.js";import{d as p,o as g,c as k,w as r,p as l,a as f,u,K as E,t as y,s as S,F as q,v as D,R as H,z as h,A as I,V as T,W as U,h as F,X as N,Y as O,q as z,k as R}from"./index.6b623a37.js";import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";const K={class:"h-36 sm:h-40 lg:h-52 xl:h-64 overflow-clip"},L=l("div",{class:"opacity-30"},[l("img",{class:"w-full",src:j})],-1),P={class:"absolute left-3 top-3"},X=H("kein Cover"),Y={class:"line-clamp-1 text-sm"},re=p({props:{title:null,coverUrl:null,isVisible:{type:Boolean}},setup(o){return(d,a)=>(g(),k(u(D),{class:q({"manga-card":!0,translucent:!o.isVisible}),button:""},{default:r(()=>[l("div",K,[f(V,{src:o.coverUrl},{default:r(()=>[L,l("div",P,[f(u(E),{class:"text-white"},{default:r(()=>[X]),_:1})])]),_:1},8,["src"])]),f(u(S),null,{default:r(()=>[l("div",Y,y(o.title),1)]),_:1})]),_:1},8,["class"]))}});var J="/assets/beep.08636030.mp3";function Q(){return new Worker("/assets/barcode-worker.5819c62b.js",{type:"module"})}const Z=["src"],ee=p({emits:["scanned"],setup(o,{emit:d}){const a=h(null),e=h(null),m=h(null),n=h(),s=h("");let v=0;I(async()=>{s.value.length>0&&(setTimeout(()=>s.value="",1e3),d("scanned",s.value))});const C=t=>{if(e.value!==null&&a.value!==null&&n.value!==null&&n.value!==void 0&&e.value.readyState===e.value.HAVE_ENOUGH_DATA){const c=a.value.getContext("2d",{willReadFrequently:!0}),i=Math.max(a.value.width/e.value.videoWidth,a.value.height/e.value.videoHeight),w=e.value.videoHeight,x=e.value.videoWidth,B=a.value.height/2-w/2*i,$=a.value.width/2-x/2*i;if(a.value.height=a.value.clientHeight,a.value.width=a.value.clientWidth,c.drawImage(e.value,$,B,x*i,w*i),t-v>200){v=t;const _=document.createElement("canvas"),A=_.getContext("2d");_.width=a.value.width/i,_.height=a.value.height/i,A.drawImage(e.value,$/i,B/i,x,w);const b=A.getImageData(0,0,_.width,_.height);n.value.postMessage({data:b.data,width:b.width,height:b.height})}}requestAnimationFrame(C)};I(async()=>{if(e.value===null)return;const t=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:{ideal:800},height:{ideal:800}}});e.value.srcObject=t,e.value.setAttribute("playsinline",""),e.value.play(),requestAnimationFrame(C)});const M=()=>{n.value=new Q,n.value.onmessage=t=>{var c;s.value!=t.data.data&&(s.value=t.data.data,(c=m.value)==null||c.play())}},W=()=>{var t;(t=n.value)==null||t.terminate()};return T(M),U(()=>{var t;e.value!==null&&(e.value.pause(),(t=e.value.srcObject)==null||t.getVideoTracks().forEach(c=>c.stop()),e.value.srcObject=null,W())}),(t,c)=>(g(),k(u(F),{"scroll-x":!1,"scroll-y":!1},{default:r(()=>[l("canvas",{class:"w-full h-48",ref_key:"displayCanvas",ref:a},null,512),l("video",{class:"hidden",ref_key:"video",ref:e},null,512),l("audio",{ref_key:"beepAudio",ref:m,src:u(J)},null,8,Z)]),_:1}))}});const ae=p({emits:["scanned"],setup(o,{emit:d}){const{client:a}=z(),e=async n=>{const{data:s,error:v}=await a.from("mangas").select().or(`gtin13.eq.${n},isbn10.eq.${n}`).single();return v||s==null?Promise.reject(new Error("Das ist kein Manga")):s},m=async n=>{try{const s=await e(n);d("scanned",s.gtin13)}catch(s){(await O.create({message:s.message,duration:2e3,color:"warning"})).present()}};return(n,s)=>(g(),k(u(N),{id:"barcode-modal","initial-breakpoint":1,breakpoints:[0,1]},{default:r(()=>[f(ee,{onScanned:m})]),_:1},8,["initial-breakpoint","breakpoints"]))}});var ue=G(ae,[["__scopeId","data-v-7457ae95"]]);const te={class:"h-full grid place-items-center"},se={class:"text-center"},ne={class:"text-6xl"},le={class:"text-md text-medium-default mt-8 w-40"},de=p({props:{emoji:null,text:null},setup(o){return(d,a)=>(g(),R("div",te,[l("div",se,[l("div",ne,y(o.emoji),1),l("div",le,y(o.text),1)])]))}});export{ue as B,de as _,re as a};

import{p as y,ar as _,r as d,P as b,q as p,az as w}from"./index.13905425.js";import{e as g}from"./mangas.5c0c8684.js";const{client:h,proxyUrlFor:q}=b(),x=o=>{const t=d([]);return p(async()=>{const r=h.from("collections").select().limit(10);o.value&&r.textSearch("collection_name",o.value,{type:"websearch",config:"german"});const{data:l,error:i}=await r;if(i)throw Error(i.message);t.value=l.map(n=>{var a;return{...n,cover:q((a=n.cover)!=null?a:"","s")}})}),{collections:w(t)}},A=o=>{const{hasPermission:t}=y(),r=_({name:null,publisherName:"",coverUrl:"",contributors:[],keywords:[]}),l=d([]),i=async n=>{var v,f;const a=h.from("mangas").select("*,user_vlb_library(*)");t("contribution.change_visibility")||a.is("is_visible",!0);const{data:s,error:u}=await a.eq("collection_id",n).order("date_published",{ascending:!1});if(u)throw Error(u.message);s!=null&&s.length>0&&(s.forEach(e=>{var m;let c;e.user_vlb_library!==null&&Array.isArray(e.user_vlb_library)&&e.user_vlb_library.length>0&&(c=(m=e.user_vlb_library[0].shelf)!=null?m:void 0),l.value.push({...g(e),shelf:c})}),r.name=(v=s[0].collection_name)!=null?v:null,r.publisherName=s[0].publisher_name,r.coverUrl=(f=l.value.map(e=>e.cover("m")).find(e=>e!=null))!=null?f:"",r.keywords=[...new Set(l.value.flatMap(({keywords:e})=>e))],r.contributors=[...new Set(l.value.flatMap(({contributors:e})=>e==null?void 0:e.map(({name:c})=>c)))])};return{mangas:l,collection:r,load:()=>{l.value=[],i(o.value)}}};export{A as a,x as u};

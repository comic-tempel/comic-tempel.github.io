import{d as p,x as v,o as _,k as D,R as W,S as B,a as h,u as r,l as E,T as j,L as H,q as T,J as V,c as b,w as m,n as i,H as q,t as U,r as N,s as O,O as F,y as M,U as L,V as R,h as G,W as J,X as P,p as X}from"./index.1d7060d5.js";import{_ as z}from"./plugin-vue_export-helper.21dcd24c.js";var K="/assets/cover-missing.a888693e.png";const Q=p({props:{src:null},setup(d){const n=v("unmounted");return(a,e)=>(_(),D(V,null,[W(h(r(E),{class:"w-full h-full object-cover object-top",src:d.src,onIonImgWillLoad:e[0]||(e[0]=c=>n.value="loading"),onIonImgDidLoad:e[1]||(e[1]=c=>n.value="loaded"),onIonError:e[2]||(e[2]=c=>n.value="missing")},null,8,["src"]),[[B,n.value=="unmounted"||n.value=="loaded"]]),n.value=="missing"?j(a.$slots,"default",{key:0}):H("",!0),W(h(r(T),{class:"m-0 h-full w-full",animated:""},null,512),[[B,n.value=="loading"]])],64))}}),Y={class:"h-36 sm:h-40 lg:h-52 xl:h-64 overflow-clip"},Z=i("div",{class:"opacity-30"},[i("img",{class:"w-full",src:K})],-1),ee={class:"absolute left-3 top-3"},ae=F("kein Cover"),te={class:"line-clamp-1 text-sm"},ue=p({props:{title:null,coverUrl:null},setup(d){return(n,a)=>(_(),b(r(O),{class:"manga-card",button:""},{default:m(()=>[i("div",Y,[h(Q,{src:d.coverUrl},{default:m(()=>[Z,i("div",ee,[h(r(q),{class:"text-white"},{default:m(()=>[ae]),_:1})])]),_:1},8,["src"])]),h(r(N),null,{default:m(()=>[i("div",te,U(d.title),1)]),_:1})]),_:1}))}});var se="/assets/beep.08636030.mp3";function ne(){return new Worker("/assets/barcode-worker.5819c62b.js",{type:"module"})}const le=["src"],oe=p({emits:["scanned"],setup(d,{emit:n}){const a=v(null),e=v(null),c=v(null),l=v(),s=v("");let f=0;M(async()=>{s.value.length>0&&(setTimeout(()=>s.value="",1e3),n("scanned",s.value))});const x=t=>{if(e.value!==null&&a.value!==null&&l.value!==null&&l.value!==void 0&&e.value.readyState===e.value.HAVE_ENOUGH_DATA){const u=a.value.getContext("2d",{willReadFrequently:!0}),o=Math.max(a.value.width/e.value.videoWidth,a.value.height/e.value.videoHeight),w=e.value.videoHeight,k=e.value.videoWidth,I=a.value.height/2-w/2*o,C=a.value.width/2-k/2*o;if(a.value.height=a.value.clientHeight,a.value.width=a.value.clientWidth,u.drawImage(e.value,C,I,k*o,w*o),t-f>200){f=t;const g=document.createElement("canvas"),S=g.getContext("2d");g.width=a.value.width/o,g.height=a.value.height/o,S.drawImage(e.value,C/o,I/o,k,w);const y=S.getImageData(0,0,g.width,g.height);l.value.postMessage({data:y.data,width:y.width,height:y.height})}}requestAnimationFrame(x)};M(async()=>{if(e.value===null)return;const t=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:{ideal:800},height:{ideal:800}}});e.value.srcObject=t,e.value.setAttribute("playsinline",""),e.value.play(),requestAnimationFrame(x)});const $=()=>{l.value=new ne,l.value.onmessage=t=>{var u;s.value!=t.data.data&&(s.value=t.data.data,(u=c.value)==null||u.play())}},A=()=>{var t;(t=l.value)==null||t.terminate()};return L($),R(()=>{var t;e.value!==null&&(e.value.pause(),(t=e.value.srcObject)==null||t.getVideoTracks().forEach(u=>u.stop()),e.value.srcObject=null,A())}),(t,u)=>(_(),b(r(G),{"scroll-x":!1,"scroll-y":!1},{default:m(()=>[i("canvas",{class:"w-full h-48",ref_key:"displayCanvas",ref:a},null,512),i("video",{class:"hidden",ref_key:"video",ref:e},null,512),i("audio",{ref_key:"beepAudio",ref:c,src:r(se)},null,8,le)]),_:1}))}});const re=p({emits:["scanned"],setup(d,{emit:n}){const{client:a}=X(),e=async l=>{const{data:s,error:f}=await a.from("mangas").select().or(`gtin13.eq.${l},isbn10.eq.${l}`).single();return f||s==null?Promise.reject(new Error("Das ist kein Manga")):s},c=async l=>{try{const s=await e(l);n("scanned",s.gtin13)}catch(s){(await P.create({message:s.message,duration:2e3,color:"warning"})).present()}};return(l,s)=>(_(),b(r(J),{id:"barcode-modal","initial-breakpoint":1,breakpoints:[0,1]},{default:m(()=>[h(oe,{onScanned:c})]),_:1},8,["initial-breakpoint","breakpoints"]))}});var de=z(re,[["__scopeId","data-v-7457ae95"]]);export{de as B,Q as _,ue as a,K as p};

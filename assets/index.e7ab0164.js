var b=Object.defineProperty,O=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var h=(e,r,t)=>r in e?b(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,v=(e,r)=>{for(var t in r||(r={}))A.call(r,t)&&h(e,t,r[t]);if(g)for(var t of g(r))S.call(r,t)&&h(e,t,r[t]);return e},y=(e,r)=>O(e,x(r));import{r as m,c as T,n as W,d as D,w as N,o as C,a as M,b as U,e as V,u as w,I as $,f as F,t as _,g as j,h as q,i as B,j as J,k as K,l as X,m as z,p as G}from"./vendor.801380ed.js";const H=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}};H();function Q(e={}){const{immediate:r=!1,onNeedRefresh:t,onOfflineReady:o,onRegistered:n,onRegisterError:a}=e;let s,c;const p=async(i=!0)=>{i&&(s==null||s.addEventListener("controlling",L=>{L.isUpdate&&window.location.reload()})),c&&c.waiting&&await W(c.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){s=new T("/sw.js",{scope:"/",type:"classic"}),s.addEventListener("activated",i=>{i.isUpdate||o==null||o()});{const i=()=>{t==null||t()};s.addEventListener("waiting",i),s.addEventListener("externalwaiting",i)}s.register({immediate:r}).then(i=>{c=i,n==null||n(i)}).catch(i=>{a==null||a(i)})}return p}function Y(e={}){const{immediate:r=!0,onNeedRefresh:t,onOfflineReady:o,onRegistered:n,onRegisterError:a}=e,s=m(!1),c=m(!1);return{updateServiceWorker:Q({immediate:r,onNeedRefresh(){s.value=!0,t==null||t()},onOfflineReady(){c.value=!0,o==null||o()},onRegistered:n,onRegisterError:a}),offlineReady:c,needRefresh:s}}const Z=D({setup(e){const{needRefresh:r,offlineReady:t,updateServiceWorker:o}=Y({onRegistered:a=>{a&&setInterval(()=>a.update(),6e4)}}),n=async()=>{await o(),window.location.reload()};return N(async()=>{r.value&&(await _.create({header:"Eine Aktualisierung ist verf\xFCgbar",message:"Kann ich sie herunterladen und das Wiki neu starten?",color:"secondary",buttons:[{text:"nein",role:"cancel"},{text:"ja",handler:n}]})).present(),t.value&&(await _.create({header:"Aktualisierung abgeschlossen",color:"secondary",duration:5e3})).present()}),(a,s)=>(C(),M(w(F),null,{default:U(()=>[V(w($))]),_:1}))}}),ee="modulepreload",P={},re="/",u=function(r,t){return!t||t.length===0?r():Promise.all(t.map(o=>{if(o=`${re}${o}`,o in P)return;P[o]=!0;const n=o.endsWith(".css"),a=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${a}`))return;const s=document.createElement("link");if(s.rel=n?"stylesheet":ee,n||(s.as="script",s.crossOrigin=""),s.href=o,document.head.appendChild(s),n)return new Promise((c,p)=>{s.addEventListener("load",c),s.addEventListener("error",p)})})).then(()=>r())},te="https://lkkhutelhlzqipepirdc.supabase.co",ne="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyNjc1OTk3MSwiZXhwIjoxOTQyMzM1OTcxfQ.zw0Ndon-xhxiSvBvWLSf8ePP5vXesxTLx_moX9bM6rk",oe="manga-wiki-media.sit.institute",se=j(te,ne,{detectSessionInUrl:!0,autoRefreshToken:!0,persistSession:!0}),ae=(e,r)=>{const t=e.replace("api.vlb.de",oe);return r===void 0?t:t.replace(/\/(s|m|l)$/,`/${r=="xl"?"":r}`)},ie=()=>({client:se,proxyUrlFor:ae}),{client:l}=ie(),d=m(l.auth.user()),R=m([]),ce=async e=>{const{data:r,error:t}=await l.auth.update({password:e});if(r!=null)d.value=r;else throw console.error(t!=null?t:"unknown Error"),Error()},le=async e=>{var o,n;if(e==null&&d.value==null)throw console.error("neither email not current user available"),new Error;const{data:r,error:t}=await l.auth.api.resetPasswordForEmail((n=e!=null?e:(o=d.value)==null?void 0:o.email)!=null?n:"");if(r==null)throw console.error(t!=null?t:"unknown Error"),Error()},ue=async e=>{const{error:r}=await l.auth.signIn(e);if(r!=null)throw console.error(r!=null?r:"unknown Error"),Error()},de=async()=>l.auth.signOut(),pe=e=>R.value.includes(e);l.auth.onAuthStateChange(async()=>{var t,o;d.value=l.auth.user(),console.log((t=d.value)==null?void 0:t.email);const{data:e,error:r}=await l.from("user_permissions").select("permissions").single();R.value=(o=e==null?void 0:e.permissions)!=null?o:[],r&&console.error(r)});const me=()=>({currentUser:q(d),hasPermission:pe,requestPasswordReset:le,updatePasswort:ce,login:ue,logout:de}),{currentUser:E}=me(),f=B({history:J("/"),routes:[{path:"/",redirect:e=>/type=(recovery|invite)/.test(e.hash)&&e.name!="PasswordRecoveryPage"?{name:"PasswordRecoveryPage",hash:e.hash}:{name:"MangaListPage"}},{path:"/mangas",name:"MangaListPage",component:()=>u(()=>import("./MangaListPage.e18a901c.js"),["assets/MangaListPage.e18a901c.js","assets/mangas.8cb725b0.js","assets/vendor.801380ed.js","assets/useMachine.bd75bb26.js"])},{path:"/manga/:gtin13",name:"MangaDetailsPage",component:()=>u(()=>import("./MangaDetailsPage.84486a26.js"),["assets/MangaDetailsPage.84486a26.js","assets/vendor.801380ed.js","assets/mangas.8cb725b0.js","assets/plugin-vue_export-helper.21dcd24c.js","assets/ui.0d1e7409.js"]),props:e=>({gtin13:Number.parseInt(e.params.gtin13)})},{path:"/manga/:gtin13/edit/:focus?",name:"MangaEditorPage",component:()=>u(()=>import("./MangaEditorPage.85e467d0.js"),["assets/MangaEditorPage.85e467d0.js","assets/vendor.801380ed.js","assets/mangas.8cb725b0.js","assets/ui.0d1e7409.js","assets/useMachine.bd75bb26.js"]),props:e=>y(v({},e.params),{gtin13:Number.parseInt(e.params.gtin13)})},{path:"/login",name:"LoginPage",component:()=>u(()=>import("./LoginPage.4d696715.js"),["assets/LoginPage.4d696715.js","assets/vendor.801380ed.js","assets/validation.0b62e0f4.js","assets/ui.0d1e7409.js","assets/plugin-vue_export-helper.21dcd24c.js","assets/useMachine.bd75bb26.js"])},{path:"/profile",name:"ProfilePage",component:()=>u(()=>import("./ProfilePage.d9b27a41.js"),["assets/ProfilePage.d9b27a41.js","assets/vendor.801380ed.js"])},{path:"/profile/password",name:"PasswordResetPage",component:()=>u(()=>import("./PasswordResetPage.4f9a646d.js"),["assets/PasswordResetPage.4f9a646d.js","assets/vendor.801380ed.js","assets/useMachine.bd75bb26.js"])},{path:"/profile/password/recovery",name:"PasswordRecoveryPage",component:()=>u(()=>import("./PasswordRecoveryPage.932520a6.js"),["assets/PasswordRecoveryPage.932520a6.js","assets/vendor.801380ed.js","assets/validation.0b62e0f4.js","assets/useMachine.bd75bb26.js"])}]});f.beforeEach(e=>{if(E.value==null&&e.name!="LoginPage"&&e.name!="PasswordRecoveryPage")return{name:"LoginPage"};if(E.value!=null&&e.name=="LoginPage")return{name:"MangaListPage"}});var fe=K({locale:"de",numberFormats:{de:{currency:{style:"currency",currencyDisplay:"symbol",currency:"EUR"},decimal:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2},percent:{style:"percent",useGrouping:!1}}}});const ge=X(Z).use(z).use(fe).use(f),I=window.matchMedia("(prefers-color-scheme: dark)"),k=e=>{document.body.classList.toggle("dark",e)};k(I.matches);I.addListener(e=>k(e.matches));f.isReady().then(()=>{ge.mount("#app"),G()});console.log=()=>{},console.error=()=>{},console.warn=()=>{};export{me as a,ie as u};

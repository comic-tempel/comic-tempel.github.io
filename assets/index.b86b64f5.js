import{r as f,c as R,n as k,d as I,w as L,o as b,a as O,b as S,e as x,u as h,I as A,f as T,t as g,g as W,h as C,i as N,j as M,k as U,l as D,m as V}from"./vendor.30967a74.js";const $=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}};$();function j(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisterError:a}=e;let s,c;const p=async(i=!0)=>{i&&(s==null||s.addEventListener("controlling",E=>{E.isUpdate&&window.location.reload()})),c&&c.waiting&&await k(c.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){s=new R("/sw.js",{scope:"/",type:"classic"}),s.addEventListener("activated",i=>{i.isUpdate||o==null||o()});{const i=()=>{n==null||n()};s.addEventListener("waiting",i),s.addEventListener("externalwaiting",i)}s.register({immediate:t}).then(i=>{c=i,r==null||r(i)}).catch(i=>{a==null||a(i)})}return p}function q(e={}){const{immediate:t=!0,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisterError:a}=e,s=f(!1),c=f(!1);return{updateServiceWorker:j({immediate:t,onNeedRefresh(){s.value=!0,n==null||n()},onOfflineReady(){c.value=!0,o==null||o()},onRegistered:r,onRegisterError:a}),offlineReady:c,needRefresh:s}}const B=I({setup(e){const{needRefresh:t,offlineReady:n,updateServiceWorker:o}=q({onRegistered:r=>{r&&setInterval(()=>r.update(),6e4)}});return L(async()=>{t.value&&(await g.create({header:"Eine Aktualisierung ist verf\xFCgbar",message:"Kann ich sie herunterladen und das Wiki neu starten?",color:"secondary",buttons:[{text:"nein",role:"cancel"},{text:"ja",handler:()=>o(!0)}]})).present(),n.value&&(await g.create({header:"Aktualisierung abgeschlossen",color:"secondary",duration:5e3})).present()}),(r,a)=>(b(),O(h(T),null,{default:S(()=>[x(h(A))]),_:1}))}}),F="modulepreload",v={},J="/",u=function(t,n){return!n||n.length===0?t():Promise.all(n.map(o=>{if(o=`${J}${o}`,o in v)return;v[o]=!0;const r=o.endsWith(".css"),a=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${a}`))return;const s=document.createElement("link");if(s.rel=r?"stylesheet":F,r||(s.as="script",s.crossOrigin=""),s.href=o,document.head.appendChild(s),r)return new Promise((c,p)=>{s.addEventListener("load",c),s.addEventListener("error",p)})})).then(()=>t())},K="https://lkkhutelhlzqipepirdc.supabase.co",X="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyNjc1OTk3MSwiZXhwIjoxOTQyMzM1OTcxfQ.zw0Ndon-xhxiSvBvWLSf8ePP5vXesxTLx_moX9bM6rk",z="manga-wiki-media.sit.institute",G=W(K,X,{detectSessionInUrl:!0,autoRefreshToken:!0,persistSession:!0}),H=(e,t)=>{const n=e.replace("api.vlb.de",z);return t===void 0?n:n.replace(/\/(s|m|l)$/,`/${t=="xl"?"":t}`)},Q=()=>({client:G,proxyUrlFor:H}),{client:l}=Q(),d=f(l.auth.user()),w=f([]),Y=async e=>{const{data:t,error:n}=await l.auth.update({password:e});if(t!=null)d.value=t;else throw console.error(n!=null?n:"unknown Error"),Error()},Z=async e=>{var o,r;if(e==null&&d.value==null)throw console.error("neither email not current user available"),new Error;const{data:t,error:n}=await l.auth.api.resetPasswordForEmail((r=e!=null?e:(o=d.value)==null?void 0:o.email)!=null?r:"");if(t==null)throw console.error(n!=null?n:"unknown Error"),Error()},ee=async e=>{const{error:t}=await l.auth.signIn(e);if(t!=null)throw console.error(t!=null?t:"unknown Error"),Error()},re=async()=>l.auth.signOut(),te=e=>w.value.includes(e);l.auth.onAuthStateChange(async()=>{var n,o;d.value=l.auth.user(),console.log((n=d.value)==null?void 0:n.email);const{data:e,error:t}=await l.from("user_permissions").select("permissions").single();w.value=(o=e==null?void 0:e.permissions)!=null?o:[],t&&console.error(t)});const ne=()=>({currentUser:C(d),hasPermission:te,requestPasswordReset:Z,updatePasswort:Y,login:ee,logout:re}),{currentUser:y}=ne(),m=N({history:M("/"),routes:[{path:"/",redirect:e=>/type=(recovery|invite)/.test(e.hash)&&e.name!="PasswordRecoveryPage"?{name:"PasswordRecoveryPage",hash:e.hash}:{name:"MangaListPage"}},{path:"/mangas",name:"MangaListPage",component:()=>u(()=>import("./MangaListPage.9c6578ff.js"),["assets/MangaListPage.9c6578ff.js","assets/vendor.30967a74.js","assets/mangas.e37fa2cc.js","assets/useMachine.27909c58.js"])},{path:"/manga/:gtin13",name:"MangaDetailsPage",component:()=>u(()=>import("./MangaDetailsPage.998a684e.js"),["assets/MangaDetailsPage.998a684e.js","assets/vendor.30967a74.js","assets/mangas.e37fa2cc.js","assets/plugin-vue_export-helper.13d32ddf.js"]),props:e=>({gtin13:Number.parseInt(e.params.gtin13)})},{path:"/login",name:"LoginPage",component:()=>u(()=>import("./LoginPage.896148d7.js"),["assets/LoginPage.896148d7.js","assets/vendor.30967a74.js","assets/validation.6b613935.js","assets/plugin-vue_export-helper.13d32ddf.js","assets/useMachine.27909c58.js"])},{path:"/profile",name:"ProfilePage",component:()=>u(()=>import("./ProfilePage.c200104a.js"),["assets/ProfilePage.c200104a.js","assets/vendor.30967a74.js"])},{path:"/profile/password",name:"PasswordResetPage",component:()=>u(()=>import("./PasswordResetPage.a0884087.js"),["assets/PasswordResetPage.a0884087.js","assets/vendor.30967a74.js","assets/useMachine.27909c58.js"])},{path:"/profile/password/recovery",name:"PasswordRecoveryPage",component:()=>u(()=>import("./PasswordRecoveryPage.d2b1ee6a.js"),["assets/PasswordRecoveryPage.d2b1ee6a.js","assets/vendor.30967a74.js","assets/validation.6b613935.js","assets/useMachine.27909c58.js"])}]});m.beforeEach(e=>{if(y.value==null&&e.name!="LoginPage"&&e.name!="PasswordRecoveryPage")return{name:"LoginPage"};if(y.value!=null&&e.name=="LoginPage")return{name:"MangaListPage"}});const oe=U(B).use(D).use(m),_=window.matchMedia("(prefers-color-scheme: dark)"),P=e=>{document.body.classList.toggle("dark",e)};P(_.matches);_.addListener(e=>P(e.matches));m.isReady().then(()=>{oe.mount("#app"),V()});console.log=()=>{},console.error=()=>{},console.warn=()=>{};export{ne as a,Q as u};

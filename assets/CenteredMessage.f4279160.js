import{_ as j,a as E}from"./WikiImg.6622f6d0.js";import{d as p,o as g,c as b,w as r,p as l,a as f,u as d,J as S,t as k,s as q,v as D,Q as H,y as h,z as M,U,V,h as T,W as N,X as O,q as F,k as z}from"./index.462cec1b.js";import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";const J={class:"h-36 sm:h-40 lg:h-52 xl:h-64 overflow-clip"},L=l("div",{class:"opacity-30"},[l("img",{class:"w-full",src:E})],-1),P={class:"absolute left-3 top-3"},Q=H("kein Cover"),R={class:"line-clamp-1 text-sm"},ce=p({props:{title:null,coverUrl:null},setup(i){return(u,a)=>(g(),b(d(D),{class:"manga-card",button:""},{default:r(()=>[l("div",J,[f(j,{src:i.coverUrl},{default:r(()=>[L,l("div",P,[f(d(S),{class:"text-white"},{default:r(()=>[Q]),_:1})])]),_:1},8,["src"])]),f(d(q),null,{default:r(()=>[l("div",R,k(i.title),1)]),_:1})]),_:1}))}});var X="/assets/beep.08636030.mp3";function K(){return new Worker("/assets/barcode-worker.5819c62b.js",{type:"module"})}const Y=["src"],Z=p({emits:["scanned"],setup(i,{emit:u}){const a=h(null),e=h(null),m=h(null),n=h(),s=h("");let v=0;M(async()=>{s.value.length>0&&(setTimeout(()=>s.value="",1e3),u("scanned",s.value))});const C=t=>{if(e.value!==null&&a.value!==null&&n.value!==null&&n.value!==void 0&&e.value.readyState===e.value.HAVE_ENOUGH_DATA){const c=a.value.getContext("2d",{willReadFrequently:!0}),o=Math.max(a.value.width/e.value.videoWidth,a.value.height/e.value.videoHeight),w=e.value.videoHeight,x=e.value.videoWidth,$=a.value.height/2-w/2*o,B=a.value.width/2-x/2*o;if(a.value.height=a.value.clientHeight,a.value.width=a.value.clientWidth,c.drawImage(e.value,B,$,x*o,w*o),t-v>200){v=t;const _=document.createElement("canvas"),I=_.getContext("2d");_.width=a.value.width/o,_.height=a.value.height/o,I.drawImage(e.value,B/o,$/o,x,w);const y=I.getImageData(0,0,_.width,_.height);n.value.postMessage({data:y.data,width:y.width,height:y.height})}}requestAnimationFrame(C)};M(async()=>{if(e.value===null)return;const t=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:{ideal:800},height:{ideal:800}}});e.value.srcObject=t,e.value.setAttribute("playsinline",""),e.value.play(),requestAnimationFrame(C)});const W=()=>{n.value=new K,n.value.onmessage=t=>{var c;s.value!=t.data.data&&(s.value=t.data.data,(c=m.value)==null||c.play())}},A=()=>{var t;(t=n.value)==null||t.terminate()};return U(W),V(()=>{var t;e.value!==null&&(e.value.pause(),(t=e.value.srcObject)==null||t.getVideoTracks().forEach(c=>c.stop()),e.value.srcObject=null,A())}),(t,c)=>(g(),b(d(T),{"scroll-x":!1,"scroll-y":!1},{default:r(()=>[l("canvas",{class:"w-full h-48",ref_key:"displayCanvas",ref:a},null,512),l("video",{class:"hidden",ref_key:"video",ref:e},null,512),l("audio",{ref_key:"beepAudio",ref:m,src:d(X)},null,8,Y)]),_:1}))}});const ee=p({emits:["scanned"],setup(i,{emit:u}){const{client:a}=F(),e=async n=>{const{data:s,error:v}=await a.from("mangas").select().or(`gtin13.eq.${n},isbn10.eq.${n}`).single();return v||s==null?Promise.reject(new Error("Das ist kein Manga")):s},m=async n=>{try{const s=await e(n);u("scanned",s.gtin13)}catch(s){(await O.create({message:s.message,duration:2e3,color:"warning"})).present()}};return(n,s)=>(g(),b(d(N),{id:"barcode-modal","initial-breakpoint":1,breakpoints:[0,1]},{default:r(()=>[f(Z,{onScanned:m})]),_:1},8,["initial-breakpoint","breakpoints"]))}});var re=G(ee,[["__scopeId","data-v-7457ae95"]]);const ae={class:"h-full grid place-items-center"},te={class:"text-center"},se={class:"text-6xl"},ne={class:"text-md text-medium-default mt-8 w-40"},de=p({props:{emoji:null,text:null},setup(i){return(u,a)=>(g(),z("div",ae,[l("div",te,[l("div",se,k(i.emoji),1),l("div",ne,k(i.text),1)])]))}});export{re as B,de as _,ce as a};

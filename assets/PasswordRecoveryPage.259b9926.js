import{d as S,o as p,z as g,a as s,w as a,u as e,a0 as E,r as R,a6 as v,q as b,a1 as C,a7 as y,p as n,t as P,B as x,c as D,a9 as k,F as B,l as T,s as U,T as A,U as O,_ as I,R as Y,i as z,j as L,m as N,n as $,h as q,S as M}from"./index.13e5300e.js";import{u as j,t as K,o as Q,p as V,a as F}from"./validation.f9f8bc5d.js";import{c as Z,u as H}from"./useMachine.ecb54bd2.js";const G=n("Um sicherzustellen, dass Dein Konto gut gesch\xFCtzt ist, verwende bitte 8 oder mehr Zeichen mit einer Kombination aus Buchstaben, Zahlen & Symbolen."),J=n("sicheres Passwort"),W=n("Passwort wiederholen"),X=n("Passwort speichern"),ee=S({props:{state:null},emits:["submit"],setup(l,{expose:u,emit:f}){const{handleSubmit:w,errors:r,meta:_,resetForm:d}=j({validationSchema:K(Q({password:V,confirmation:V.nonempty("Bitte wiederhole das Passwort")}).refine(o=>o.password==o.confirmation,{message:"Die Passw\xF6rter stimmen nicht \xFCberein",path:["confirmation"]}))}),{value:c}=F("password"),{value:t}=F("confirmation"),i=w(o=>f("submit",{password:o.password}));return u({clear:d}),(o,m)=>(p(),g("div",null,[s(e(E),null,{default:a(()=>[G]),_:1}),s(e(x),null,{default:a(()=>[s(e(R),{class:v({"ion-invalid":e(r).password})},{default:a(()=>[s(e(b),{position:"floating"},{default:a(()=>[J]),_:1}),s(e(C),{modelValue:e(c),"onUpdate:modelValue":m[0]||(m[0]=h=>y(c)?c.value=h:null),name:"password",type:"password",required:"true",enterkeyhint:"send",disabled:l.state=="Recovering"},null,8,["modelValue","disabled"]),s(e(E),{slot:"error"},{default:a(()=>[n(P(e(r).password),1)]),_:1})]),_:1},8,["class"]),s(e(R),{class:v({"ion-invalid":e(r).confirmation})},{default:a(()=>[s(e(b),{position:"floating"},{default:a(()=>[W]),_:1}),s(e(C),{modelValue:e(t),"onUpdate:modelValue":m[1]||(m[1]=h=>y(t)?t.value=h:null),name:"confirmation",type:"password",required:"true",enterkeyhint:"send",disabled:l.state=="Recovering"},null,8,["modelValue","disabled"]),s(e(E),{slot:"error"},{default:a(()=>[n(P(e(r).confirmation),1)]),_:1})]),_:1},8,["class"])]),_:1}),s(e(T),{class:"absolute bottom-3.5 left-3.5 right-3.5",expand:"full",disabled:!e(_).valid||l.state=="Recovering",onClick:e(i)},{default:a(()=>[l.state=="Recovering"?(p(),D(e(k),{key:0,slot:"icon-only"})):(p(),g(B,{key:1},[X],64))]),_:1},8,["disabled","onClick"])]))}}),se=n("Mein Passwort"),ae={class:"p-4"},re=S({setup(l){const u=U(null),{updatePasswort:f}=A(),{replace:w}=O(),r=Z({id:"PasswordRecovery",initial:"AwaitingPassword",states:{AwaitingPassword:{on:{RECOVERY_REQUESTED:{target:"Recovering",actions:"recoverPassword"}}},Recovering:{on:{RECOVERY_SUCCEEDED:{target:"AwaitingPassword",actions:["toastSuccess","clearForm","exit"]},RECOVERY_FAILED:{target:"AwaitingPassword",actions:"toastFailure"}}}}},{actions:{toastSuccess:async()=>{(await I.create({message:"Dein Passwort wurde gespeichert.",color:"success",duration:2e3})).present()},toastFailure:async()=>{(await I.create({message:"Dein Passwort konnte nicht gespeichert werden. Bitte versuche es sp\xE4ter erneut.",color:"danger",duration:2e3})).present()},clearForm:()=>{var t;return(t=u.value)==null?void 0:t.clear()},exit:()=>w("/"),recoverPassword:async(t,i)=>{try{await f(i.password),d("RECOVERY_SUCCEEDED")}catch{d("RECOVERY_FAILED")}}}}),{state:_,send:d}=H(r,{devTools:!1}),c=Y(()=>_.value.value);return(t,i)=>(p(),D(e(z),null,{default:a(()=>[s(e(L),{class:"ion-no-border"},{default:a(()=>[s(e($),null,{default:a(()=>[s(e(N),null,{default:a(()=>[se]),_:1})]),_:1})]),_:1}),s(e(q),null,{default:a(()=>[M("div",ae,[s(ee,{ref_key:"form",ref:u,state:e(c),onSubmit:i[0]||(i[0]=o=>e(d)("RECOVERY_REQUESTED",o))},null,8,["state"])])]),_:1})]),_:1}))}});export{re as default};

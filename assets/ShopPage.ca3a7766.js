import{d as g,o as v,k as B,a as o,w as t,M as h,u as n,E as C,L as _,Y as w,v as I,V,N as x,l as b,S as y,y as E,z as S,q as k,a3 as T,a4 as D,a5 as $,c as N,B as F,a6 as M,D as L,ao as P,G as j,h as q,i as z,aC as A}from"./index.79d194cd.js";import{_ as G}from"./BarcodeScanner.9ae2f6af.js";import{a as H}from"./ui.82bacb6e.js";var U="/assets/logo-comic-tempel.a6b5d799.jpg";const W=b("img",{src:U},null,-1),Y=g({__name:"ShopCardComicTempel",props:{isConnected:{type:Boolean}},emits:["connect","disconnect"],setup(a,{emit:c}){const i=l=>{/^B!\w+!\w$/.test(l)?(y.dismiss(),c("connect",l)):H({message:"Das ist keine Tempel-Card",color:"warning"})},u=()=>{c("disconnect")};return(l,p)=>(v(),B(x,null,[o(n(I),{class:"text-center"},{default:t(()=>[W,h(o(n(C),{id:"scan-tempel-card",fill:"clear"},{default:t(()=>[_("Tempel-Card scannen")]),_:1},512),[[w,!a.isConnected]]),h(o(n(C),{fill:"clear",onClick:u},{default:t(()=>[_("Verbindung trennen")]),_:1},512),[[w,a.isConnected]])]),_:1}),o(n(V),{class:"barcode-scanner",trigger:"scan-tempel-card","initial-breakpoint":1,breakpoints:[0,1]},{default:t(()=>[o(G,{onScanned:i})]),_:1},8,["initial-breakpoint","breakpoints"])],64))}}),J=()=>{const{client:a}=k(),{currentUser:c}=E(),i=S([]);return{loadConnections:async()=>{const{data:s,error:e}=await a.from("user_shops").select();if(e)throw new Error(e.message);i.value=s},findConnection:s=>i.value.find(({shop_name:e})=>e==s),connectShop:async(s,e)=>{var d,f;const{error:r}=await a.from("user_shops").upsert({user_id:(f=(d=c.value)==null?void 0:d.id)!=null?f:"",shop_name:s,shop_user_id:e.trim()});if(r)throw Error(r.message)},disconnectShop:async s=>{var r;const{error:e}=await a.from("user_shops").delete().match({user_id:(r=c.value)==null?void 0:r.id,shop_name:s});if(e)throw Error(e.message)}}},K={class:"p-8"},X=g({__name:"ShopPage",setup(a){const{client:c}=k(),{connectShop:i,disconnectShop:u,findConnection:l,loadConnections:p}=J();let m=S(null);return T(()=>{m.value=c.channel("any").on("postgres_changes",{event:"*",schema:"public",table:"user_shops"},p).subscribe()}),D(()=>{var s;return(s=m.value)==null?void 0:s.unsubscribe()}),$(()=>p()),(s,e)=>{const r=A("Feature");return v(),N(n(z),null,{default:t(()=>[o(n(j),null,{default:t(()=>[o(n(F),null,{default:t(()=>[o(n(M),null,{default:t(()=>[_("Meine Shops")]),_:1}),o(n(L),{slot:"start"},{default:t(()=>[o(n(P),{"default-href":"/",text:""})]),_:1})]),_:1})]),_:1}),o(n(q),null,{default:t(()=>[b("div",K,[o(r,{"feature-key":"shopsComicTempel"},{default:t(()=>[o(Y,{"is-connected":n(l)("comic-tempel")!==void 0,onConnect:e[0]||(e[0]=d=>n(i)("comic-tempel",d)),onDisconnect:e[1]||(e[1]=d=>n(u)("comic-tempel"))},null,8,["is-connected"])]),_:1})])]),_:1})]),_:1})}}});export{X as default};

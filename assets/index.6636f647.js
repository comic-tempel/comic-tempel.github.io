import{r as m,c as R,n as k,d as I,w as L,o as b,a as O,b as x,e as S,u as h,I as A,f as T,t as g,g as W,h as C,i as D,j as N,k as U,l as M,m as V,p as $}from"./vendor.4c1cb8ec.js";const F=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}};F();function j(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisterError:a}=e;let s,c;const p=async(i=!0)=>{i&&(s==null||s.addEventListener("controlling",E=>{E.isUpdate&&window.location.reload()})),c&&c.waiting&&await k(c.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){s=new R("/sw.js",{scope:"/",type:"classic"}),s.addEventListener("activated",i=>{i.isUpdate||o==null||o()});{const i=()=>{n==null||n()};s.addEventListener("waiting",i),s.addEventListener("externalwaiting",i)}s.register({immediate:t}).then(i=>{c=i,r==null||r(i)}).catch(i=>{a==null||a(i)})}return p}function q(e={}){const{immediate:t=!0,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisterError:a}=e,s=m(!1),c=m(!1);return{updateServiceWorker:j({immediate:t,onNeedRefresh(){s.value=!0,n==null||n()},onOfflineReady(){c.value=!0,o==null||o()},onRegistered:r,onRegisterError:a}),offlineReady:c,needRefresh:s}}const B=I({setup(e){const{needRefresh:t,offlineReady:n,updateServiceWorker:o}=q({onRegistered:a=>{a&&setInterval(()=>a.update(),6e4)}}),r=async()=>{await o(),window.location.reload()};return L(async()=>{t.value&&(await g.create({header:"Eine Aktualisierung ist verf\xFCgbar",message:"Kann ich sie herunterladen und das Wiki neu starten?",color:"secondary",buttons:[{text:"nein",role:"cancel"},{text:"ja",handler:r}]})).present(),n.value&&(await g.create({header:"Aktualisierung abgeschlossen",color:"secondary",duration:5e3})).present()}),(a,s)=>(b(),O(h(T),null,{default:x(()=>[S(h(A))]),_:1}))}}),J="modulepreload",v={},K="/",u=function(t,n){return!n||n.length===0?t():Promise.all(n.map(o=>{if(o=`${K}${o}`,o in v)return;v[o]=!0;const r=o.endsWith(".css"),a=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${a}`))return;const s=document.createElement("link");if(s.rel=r?"stylesheet":J,r||(s.as="script",s.crossOrigin=""),s.href=o,document.head.appendChild(s),r)return new Promise((c,p)=>{s.addEventListener("load",c),s.addEventListener("error",p)})})).then(()=>t())},X="https://lkkhutelhlzqipepirdc.supabase.co",z="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyNjc1OTk3MSwiZXhwIjoxOTQyMzM1OTcxfQ.zw0Ndon-xhxiSvBvWLSf8ePP5vXesxTLx_moX9bM6rk",G="manga-wiki-media.sit.institute",H=W(X,z,{detectSessionInUrl:!0,autoRefreshToken:!0,persistSession:!0}),Q=(e,t)=>{const n=e.replace("api.vlb.de",G);return t===void 0?n:n.replace(/\/(s|m|l)$/,`/${t=="xl"?"":t}`)},Y=()=>({client:H,proxyUrlFor:Q}),{client:l}=Y(),d=m(l.auth.user()),w=m([]),Z=async e=>{const{data:t,error:n}=await l.auth.update({password:e});if(t!=null)d.value=t;else throw console.error(n!=null?n:"unknown Error"),Error()},ee=async e=>{var o,r;if(e==null&&d.value==null)throw console.error("neither email not current user available"),new Error;const{data:t,error:n}=await l.auth.api.resetPasswordForEmail((r=e!=null?e:(o=d.value)==null?void 0:o.email)!=null?r:"");if(t==null)throw console.error(n!=null?n:"unknown Error"),Error()},re=async e=>{const{error:t}=await l.auth.signIn(e);if(t!=null)throw console.error(t!=null?t:"unknown Error"),Error()},te=async()=>l.auth.signOut(),ne=e=>w.value.includes(e);l.auth.onAuthStateChange(async()=>{var n,o;d.value=l.auth.user(),console.log((n=d.value)==null?void 0:n.email);const{data:e,error:t}=await l.from("user_permissions").select("permissions").single();w.value=(o=e==null?void 0:e.permissions)!=null?o:[],t&&console.error(t)});const oe=()=>({currentUser:C(d),hasPermission:ne,requestPasswordReset:ee,updatePasswort:Z,login:re,logout:te}),{currentUser:y}=oe(),f=D({history:N("/"),routes:[{path:"/",redirect:e=>/type=(recovery|invite)/.test(e.hash)&&e.name!="PasswordRecoveryPage"?{name:"PasswordRecoveryPage",hash:e.hash}:{name:"MangaListPage"}},{path:"/mangas",name:"MangaListPage",component:()=>u(()=>import("./MangaListPage.a2b31e06.js"),["assets/MangaListPage.a2b31e06.js","assets/vendor.4c1cb8ec.js","assets/mangas.217a4761.js","assets/useMachine.7746c2a6.js"])},{path:"/manga/:gtin13",name:"MangaDetailsPage",component:()=>u(()=>import("./MangaDetailsPage.07a857ef.js"),["assets/MangaDetailsPage.07a857ef.js","assets/vendor.4c1cb8ec.js","assets/mangas.217a4761.js","assets/plugin-vue_export-helper.a0ead400.js"]),props:e=>({gtin13:Number.parseInt(e.params.gtin13)})},{path:"/login",name:"LoginPage",component:()=>u(()=>import("./LoginPage.be2de8fc.js"),["assets/LoginPage.be2de8fc.js","assets/vendor.4c1cb8ec.js","assets/validation.478ffba9.js","assets/plugin-vue_export-helper.a0ead400.js","assets/useMachine.7746c2a6.js"])},{path:"/profile",name:"ProfilePage",component:()=>u(()=>import("./ProfilePage.1c3e4188.js"),["assets/ProfilePage.1c3e4188.js","assets/vendor.4c1cb8ec.js"])},{path:"/profile/password",name:"PasswordResetPage",component:()=>u(()=>import("./PasswordResetPage.b09f1442.js"),["assets/PasswordResetPage.b09f1442.js","assets/vendor.4c1cb8ec.js","assets/useMachine.7746c2a6.js"])},{path:"/profile/password/recovery",name:"PasswordRecoveryPage",component:()=>u(()=>import("./PasswordRecoveryPage.f323ef4d.js"),["assets/PasswordRecoveryPage.f323ef4d.js","assets/vendor.4c1cb8ec.js","assets/validation.478ffba9.js","assets/useMachine.7746c2a6.js"])}]});f.beforeEach(e=>{if(y.value==null&&e.name!="LoginPage"&&e.name!="PasswordRecoveryPage")return{name:"LoginPage"};if(y.value!=null&&e.name=="LoginPage")return{name:"MangaListPage"}});const se=U({locale:"de",numberFormats:{de:{currency:{style:"currency",currencyDisplay:"symbol",currency:"EUR"},decimal:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2},percent:{style:"percent",useGrouping:!1}}}}),ae=M(B).use(V).use(se).use(f),_=window.matchMedia("(prefers-color-scheme: dark)"),P=e=>{document.body.classList.toggle("dark",e)};P(_.matches);_.addListener(e=>P(e.matches));f.isReady().then(()=>{ae.mount("#app"),$()});console.log=()=>{},console.error=()=>{},console.warn=()=>{};export{oe as a,Y as u};
